---
alwaysApply: true
---

StravaGoals application allows users to define, track, and visualize annual training goals based on generated activity data. Users can create, edit, and delete goals, view the history of changes, and generate suggestions for new or modified goals using a simple AI module.

## Tech Stack

### Frontend

Astro 5.15 - Main framework for pages and routing

Vue 3.5 - Interactive components (Islands Architecture)

TypeScript 5

Tailwind 4.1

### Backend

Supabase

### AI

Openrouter.ai

### CI/CD and Hosting

GitHub Actions for building CI/CD pipelines

Cloudflare Pages for hosting the application via a Docker image

## Project Structure

- `./src` - source code
- `./src/pages` - Astro pages (file-based routing): each .astro file becomes a route
- `./src/layouts` - Astro layouts for shared page structure (AppLayout.astro)
- `./src/components` - Vue components (interactive islands with client:\* directives)
- `./src/components/ui` - small reusable UI components from shadcn/vue (buttons, cards, dialogs, etc.)
- `./src/components/layout` - larger structural components (Navbar, Footer)
- `./src/components/views` - main view components for pages (SettingsView, etc.)
- `./src/composables` - Vue composables (useAuth, etc.)
- `./src/db` - Supabase clients and database types
- `./src/services` - business logic services (sports, activities, etc.)
- `./src/validators` - Zod validation schemas
- `./src/plugins` - Vue app configuration (Pinia, Supabase)
- `./src/stores` - Pinia stores for state management (toast, counter)
- `./src/assets` - static assets (styles with Tailwind)
- `./src/lib` - utility functions (cn for class merging)
- `./public` - public static files served as-is

Always update this section after modifying the directory structure.

## Architecture Notes

The project uses Astro's Islands Architecture:

- **Pages (.astro)**: Static or server-rendered pages with file-based routing
- **Components (.vue)**: Interactive UI components that are hydrated as "islands"
- **Hydration**: Use client:load, client:idle, or client:visible directives on Vue components
- **Routing**: No Vue Router - use standard <a> tags and Astro's file-based routing
- **State Management**: Pinia works in Vue components with client:\* directives
- **Data Fetching**: Can be done server-side in .astro pages or client-side in .vue components

## Coding practices

### Guidelines for clean code

- Use feedback from linters to improve the code when making changes.
- Prioritize error handling and edge cases.
- Handle errors and edge cases at the beginning of functions.
- Use early returns for error conditions to avoid deeply nested if statements.
- Place the happy path last in the function for improved readability.
- Avoid unnecessary else statements; use if-return pattern instead.
- Use guard clauses to handle preconditions and invalid states early.
- Implement proper error logging and user-friendly error messages.
- Consider using custom error types or error factories for consistent error handling.

### Guidelines for SUPPORT_LEVEL

#### SUPPORT_BEGINNER

- When running in agent mode, execute up to 3 actions at a time and ask for approval or course correction afterwards.
- Write code with clear variable names and include explanatory comments for non-obvious logic. Avoid shorthand syntax and complex patterns.
- Provide full implementations rather than partial snippets. Include import statements, required dependencies, and initialization code.
- Add defensive coding patterns and clear error handling. Include validation for user inputs and explicit type checking.
- Suggest simpler solutions first, then offer more optimized versions with explanations of the trade-offs.
- Briefly explain why certain approaches are used and link to relevant documentation or learning resources.
- When suggesting fixes for errors, explain the root cause and how the solution addresses it to build understanding. Ask for confirmation before proceeding.
- Offer introducing basic test cases that demonstrate how the code works and common edge cases to consider.

### Guidelines for ARCHITECTURE

#### CLEAN_ARCHITECTURE

- Strictly separate code into layers: entities, use cases, interfaces, and frameworks
- Ensure dependencies point inward, with inner layers having no knowledge of outer layers
- Implement domain entities that encapsulate {{business_rules}} without framework dependencies
- Use interfaces (ports) and implementations (adapters) to isolate external dependencies
- Create use cases that orchestrate entity interactions for specific business operations
- Implement mappers to transform data between layers to maintain separation of concerns

# Commands

### Development

- `npm run dev` : Start development server
- `npm run build` : Build for production
- `npm run preview` : Preview production build locally

### Testing

- `npm run test:unit` : Run unit tests (Vitest)
- `npm run test:unit:watch` : Run unit tests in watch mode
- `npm run test:unit:ui` : Open Vitest UI
- `npm run test:unit:coverage` : Generate test coverage report
- `npm run test:e2e` : Run end-to-end tests (Playwright)
- `npm run test:e2e:ui` : Open Playwright UI
- `npm run test:e2e:headed` : Run E2E tests with visible browser
- `npm run test:e2e:debug` : Debug E2E tests
- `npm run test:e2e:codegen` : Generate E2E tests with Playwright codegen

### Code Quality

- `npm run lint` : Run ESLint and auto-fix issues
- `npm run format` : Run Prettier formatter on source files
